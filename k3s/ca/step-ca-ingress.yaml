# Ingress does not work here.
# Traefik could not verify TLS cert with DNS name as SAN,
# which is auto-generated by Step CA on its HTTP interface.
apiVersion: traefik.io/v1alpha1
kind: IngressRouteTCP
metadata:
  name: step-ca
spec:
  routes:
  - match: HostSNI(`step-ca.magicloud.lan`)
    services:
    - name: step-certificates
      port: 443
  tls:
    passthrough: true
---
apiVersion: externaldns.k8s.io/v1alpha1
kind: DNSEndpoint
metadata:
 name: step-ca
spec:
 endpoints:
   - dnsName: step-ca.magicloud.lan
     recordType: A
     targets:
       - 192.168.0.102